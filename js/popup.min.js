!function(e){function t(...t){e.DEBUG>1&&console.log(...t)}class i{static nextId=0;static nextZIndex=9900;static popups=new Set;constructor(e={}){this.config=Object.assign({type:null,title:null,theme:null,modal:!1,content:null,className:"popup",escapeKeyClose:!1,clickAwayClose:!1,beforeClose(){},afterClose(){},beforeOpen(){},afterOpen(){},animation:null,backdrop:null,position:null,size:null,draggable:!1,trapFocus:!0,closeX:!0,buttons:[],timer:null,el:null},e),this.id=this.config.id||"popup-"+i.nextId++,this.config.el?this.element=this.config.el:this.createElement(this.config),this.handleKeyUp=this.handleKeyUp.bind(this),this.element.CONTROLLER=this}newEl(e,t={}){let i=document.createElement(e);return Object.entries(t).forEach(([e,t])=>i[e]=t),i}getAriaRole(e){return({modal:"modal",dropdown:"listbox",alert:"alert",toast:"status",notification:"status",tooltip:"tooltip"})?.[e]||"dialog"}createElement(e){t("popup.createElement(), config =",e);let s=this.id,n=e.className,l=e.type?` ${n}__${e.type}`:"",o=e.theme?` ${n}__${e.theme}`:"",a="string"==typeof e.size?` ${n}--${e.size}`:"",c=e.position?` ${n}--${e.position}`:"",h=this.newEl("div",{id:s,className:n+l+o+c+a}),p=[e.modal,-1,this.getAriaRole(e.type)];["aria-modal","tabindex","role"].forEach((e,t)=>h.setAttribute(e,p[t])),this.popup=h;let r=`${n}__header`;if(e.title){let d=this.newEl("div",{id:s+"-title",className:`${n}__title`,innerHTML:e.title});this.title=d}else r+=` ${n}__header--no-title`;if(e.closeX){let u=this.newEl("a",{href:"javascript:void(0);",className:`${n}__close`,innerHTML:"&times;"});u.addEventListener("click",e=>this.close({event:e,src:"closeX"})),this.closeX=u}let m=this.newEl("div",{className:r});this.title&&m.appendChild(this.title),this.closeX&&m.appendChild(this.closeX),h.appendChild(m),this.header=m;let f=this.newEl("div",{className:`${n}__content`,innerHTML:""});e.content instanceof HTMLElement?f.appendChild(e.content):f.innerHTML=e.content||e.message,h.appendChild(f),this.content=f;let b=`${n}__footer`;e.buttons.length||(b+=` ${n}__footer--no-buttons`);let g=this.newEl("div",{className:b});if(e.buttons.forEach(e=>{let t=this.newEl("button",{type:"button",innerHTML:e.text,className:`${n}__button ${e.className}`});t.addEventListener("click",e.onClick||(e=>this.close({event:e,src:"button"}))),g.appendChild(t)}),h.appendChild(g),this.footer=g,this.config.modal||this.config.backdrop){let y=this.config.backdrop||"transparent",E=this.newEl("div",{className:`${n}__backdrop`});y&&E.classList.add(`${n}__backdrop--${y}`),E.addEventListener("click",e=>{e.target===E&&this.config.clickAwayClose&&this.close({event:e,src:"backdrop"})}),E.appendChild(h),this.backdrop=E}let v=this.config.zIndex||i.nextZIndex++;return this.element=this.backdrop||h,this.element.style.zIndex=v,this.element}show(e={}){if(t("popup.show(), options =",e),"abort"===this.config.beforeOpen(this,e))return;i.popups.add(this);let s=this.config.className,n=e.content||e.message,l=this.config.animation||e.animation;if(this.title||(this.title=this.element.querySelector(`.${s}__title`)),this.content||(this.content=this.element.querySelector(`.${s}__content`)),e.title&&this.title&&(this.title.innerHTML=e.title),n&&this.content&&(this.content.innerHTML="",n instanceof HTMLElement?this.content.appendChild(n):this.content.innerHTML=n),l){let o=`${s}--${l}-in`;this.popup.classList.add(o);let a=()=>{this.element.classList.remove(o)};this.popup.addEventListener("animationend",a,{once:!0})}return document.body.appendChild(this.element),document.addEventListener("keyup",this.handleKeyUp),requestAnimationFrame(()=>this.element.classList.add(`${s}--visible`)),this.config.timer&&(this.timer=setTimeout(()=>this.close({src:"timer"}),this.config.timer)),this.config.trapFocus&&this.trapFocus(),this.config.afterOpen(this)}close(e={}){if(t("popup.close(), options =",e),!i.popups.has(this))return t("popup.close(), already closed... ignore");if("abort"===this.config.beforeClose(this,e))return;document.removeEventListener("keyup",this.handleKeyUp),this.timer&&clearTimeout(this.timer),i.popups.delete(this);let s=this.config.className,n=this.config.animation||e.animation,l=t=>{t&&this.popup.classList.remove(t),this.element.classList.remove(`${s}--visible`),document.body.removeChild(this.element),this.config.afterClose(this,e)};if(n){let o=`${s}--${n}-out`;this.popup.classList.add(o),this.element.addEventListener("animationend",()=>l(o),{once:!0})}else l()}trapFocus(){let e='button, [href], input:not([type="hidden"]):not([disabled]), select, textarea, [tabindex]:not([tabindex="-1"])',t=this.popup.querySelectorAll(e),i=t[0],s=t[t.length-1],n=this.content.querySelector(e);this.firstFocusable=n||i,this.firstFocusable.focus(),this.popup.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),i.focus()))})}handleKeyUp(e){t("popup.handleKeyUp()"),"Escape"===e.key&&this.config.escapeKeyClose&&this.close({event:e,src:"escape"})}}e.lib=e.lib||{},e.lib.Popup=i}(window.F1=window.F1||{});