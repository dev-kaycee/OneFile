!function(e){function t(...t){e.DEBUG>2&&console.log(...t)}e.lib=e.lib||{},e.lib.Select=class e{constructor(e,t={}){this.select=e,e.hidden=!0,e.hasAttribute("data-value")&&(e.value=e.dataset.value),this.config=Object.assign({},e.dataset,t),this.selectPrompt=this.config.selectPrompt??"Select...",this.select.after(this.createElement()),this.element.CONTROLLER=this,this.handleGlobalClickBound=this.handleGlobalClick.bind(this),this.select.focus=()=>this.valueDisplay.focus(),this.select.disabled||this.addEventListeners()}estop(e){e.preventDefault(),e.stopPropagation()}newEl(e,t={}){let s=document.createElement(e);return Object.entries(t).forEach(([e,t])=>s[e]=t),s}createElement(){let e=this.config.className||"select",t=this.select?.className||"",s=e+t+("large"===this.config.size?` ${e}--large`:"");return this.element=this.newEl("div",{className:s,ariaLabel:`${this.select.id||this.select.name}_${e}_ui`}),this.valueDisplay=this.newEl("button",{className:`${e}__value`,type:"button",ariaHasPopup:"combobox",ariaExpanded:"false",ariaDisabled:this.select.disabled,innerHTML:`<span>${this.selectPrompt}</span>`}),this.dropdown=this.newEl("div",{role:"combobox",ariaLabel:"Dropdown"}),this.searchInput=this.newEl("input",{role:"searchbox",placeholder:this.config.searchPrompt??"Search..."}),this.utilBar=this.newEl("div",{className:`${e}__utilbar`,innerHTML:this.config.utilBarContent??"<p>- no results -</p>"}),this.optsList=this.newEl("ul",{role:"listbox",ariaLabel:"Options",innerHTML:this.getOptionsHtml(),tabIndex:"-1"}),this.clearX=this.newEl("a",{className:`${e}__clear`,ariaLabel:"Clear X",tabIndex:"0",hidden:!0}),this.options=Array.from(this.optsList.children),this.clearX.innerHTML=this.config.clearPrompt??"",this.element.classList.toggle("select--noresults",0===this.options.length),this.select.value&&this.selectOption(this.select.value,"init"),this.config.searchable&&this.dropdown.append(this.searchInput),this.dropdown.append(this.utilBar,this.optsList),this.element.append(this.valueDisplay,this.dropdown,this.clearX),this.element}updateOptions(){this.optsList.innerHTML=this.getOptionsHtml(),this.options=Array.from(this.optsList.children)}getOptionsHtml(){return Array.from(this.select.options).map(e=>`<li data-value="${e.value}" role="option" ${e.value==this.select.value?'aria-selected="true"':""} tabindex="0">${e.title||e.text}</li>`).join("")}handleGlobalClick(e){if(this.element.contains(e.target)){if(0===e.button&&this.optsList.contains(e.target)){let t=e.target.closest("li");t&&this.selectAndClose(e,t.dataset?.value)}}else this.toggleDropdown("closed","global")}handleValueKeyDown(e){"Space"===e.code||"ArrowDown"===e.code?(this.estop(e),this.toggleDropdown("open")):"Enter"===e.code&&(this.estop(e),this.select.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter",key:"Enter",keyCode:13,bubbles:!0})))}handleSearchKeyDown(e){if("ArrowDown"===e.code||"Tab"===e.code)this.focusNext(e.code,e);else if("Escape"===e.code)this.estop(e),this.toggleDropdown("closed");else if("Enter"===e.code){if(this.estop(e),this?.selectableOptions===1){let t=this.options.find(e=>!e.hidden);this.selectAndClose(e,t.dataset.value)}else this.toggleDropdown("closed")}}handleOptionsKeyDown(e){"Escape"===e.code?this.toggleDropdown("closed"):"ArrowDown"===e.code||"ArrowUp"===e.code?this.focusNext(e.code,e):"Enter"===e.code?this.selectAndClose(e,document.activeElement.dataset.value):"Tab"===e.code&&this.focusNext(e.shiftKey?"ArrowUp":"ArrowDown",e)}handleReset(){setTimeout(()=>this.selectOption(this.select.defaultValue,"init"),0)}handleClear(e){("Enter"===e.code||"click"===e.type)&&this.selectAndClose(e,"")}addEventListeners(){this.valueDisplay.addEventListener("keydown",this.handleValueKeyDown.bind(this)),this.valueDisplay.addEventListener("click",()=>this.toggleDropdown()),this.optsList.addEventListener("keydown",this.handleOptionsKeyDown.bind(this)),this.select?.form.addEventListener("reset",this.handleReset.bind(this)),this.config.clearPrompt&&(this.clearX.addEventListener("keydown",this.handleClear.bind(this)),this.clearX.addEventListener("click",this.handleClear.bind(this))),this.config.searchable&&(this.searchInput.addEventListener("keydown",this.handleSearchKeyDown.bind(this)),this.searchInput.addEventListener("input",()=>this.filterOptions())),this.config?.onUtilBarKeyDown&&this.utilBar.addEventListener("keydown",this.config.onUtilBarKeyDown.bind(this))}firstVisibleOption(e){let t=this.optsList.getBoundingClientRect();for(let s=0;s<e.length;s++){let i=e[s],l=i.getBoundingClientRect();if(l.top>t.top-.34*l.height)return i}}toggleDropdown(e=null,t="internal"){let s="true"===this.valueDisplay.getAttribute("aria-expanded")?"open":"closed",i=e??("open"===s?"closed":"open");if(this.valueDisplay.setAttribute("aria-expanded","open"===i),this.element.classList.toggle("select--open","open"===i),"open"===i){if(s===i)return;let l=this.dropdown.getBoundingClientRect(),n=window.innerHeight-l.bottom,o=l.top,a=n<l.height&&o>l.height;this.element.classList.toggle("select--dropup",a);let h=this.optsList.querySelector('li[aria-selected="true"]');if(h){let r=this.optsList.getBoundingClientRect(),c=h.getBoundingClientRect();this.optsList.scrollTop+=c.top-r.top-r.height/2+c.height/2}this.config.searchable?this.searchInput.focus():h?h.focus():this.focusNext("ArrowDown"),document.addEventListener("mousedown",this.handleGlobalClickBound)}else this.valueDisplay.focus(),this.element.classList.remove("select--dropup"),document.removeEventListener("mousedown",this.handleGlobalClickBound)}selectAndClose(e,t){this.estop(e),this.selectOption(t),this.toggleDropdown("closed")}filterOptions(){this.selectableOptions=0;let e=this.searchInput.value.toLowerCase();this.options.forEach(t=>{let s=t.textContent.toLowerCase().includes(e);s&&this.selectableOptions++,t.hidden=!s}),this.element.classList.toggle("select--noresults",0===this.selectableOptions),this.optsList.hidden=0===this.selectableOptions}selectOption(e,t){let s=Array.from(this.select.options).find(t=>t.value===e);if(this.select.value=e,s&&(s.selected=!0),this.clearX.hidden=!this.config.clearPrompt||!e,this.valueDisplay.firstElementChild.innerHTML=s?s.title||s.text:this.selectPrompt,this.options.forEach(t=>t.setAttribute("aria-selected",t.dataset.value==e)),t)return this.select.defaultValue=e;setTimeout(()=>this.select.dispatchEvent(new Event("change",{bubbles:!0}))),this.searchInput.value="",this.filterOptions()}focusNext(e,t){if(this.config.beforeFocusNext?.bind(this)(e,t))return;t&&this.estop(t);let s=this.options.filter(e=>!e.hidden),i=s.indexOf(document.activeElement);if(-1===i)return this.firstVisibleOption(s)?.focus();if(0===i&&this.config.searchable&&("ArrowUp"===e||t?.shiftKey&&"Tab"===t.code))return this.searchInput.focus();let l="ArrowUp"===e?(i-1+s.length)%s.length:(i+1)%s.length;s[l].focus()}}}(window.F1=window.F1||{});